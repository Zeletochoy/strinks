{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/offerings.css"/>
<link rel="stylesheet" href="/static/css/getmdl-select.min.css">
{% endblock %}

{% block extra_js %}
<script src="/static/js/tree.min.js"></script>
<script src="/static/js/offerings.js"></script>
<script src="/static/js/styles.js"></script>
<script defer src="/static/js/getmdl-select.min.js"></script>
{% endblock %}

{% block content %}
<form method="GET">

  <div class="mdl-grid filter-bar">
    <!--Shop-->
    <div class="mdl-cell mdl-cell--2-col">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" style="width: 100%;">
        <input type="text" value="" class="mdl-textfield__input" id="shop_id" readonly>
        <input type="hidden" value="" name="shop_id" onchange="this.form.submit()">
        <label for="shop_id" class="mdl-textfield__label">Shop</label>
        <ul for="shop_id" class="mdl-menu mdl-menu--bottom-left mdl-js-menu" style="width: auto; min-width: 200px;">
          <li class="mdl-menu__item" data-val=""{% if not shop_id %} data-selected="true"{% endif %}>All</li>
          {% for shop in shops %}
          <li class="mdl-menu__item" data-val="{{shop.shop_id}}"{% if shop.shop_id == shop_id %} data-selected="true"{% endif %}>
            {{shop.name}}
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <!--Value Factor-->
    <div class="mdl-cell mdl-cell--2-col">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select getmdl-select__fix-height" style="width: 100%;">
        <input type="text" value="" class="mdl-textfield__input" id="value_factor" readonly>
        <input type="hidden" value="" name="value_factor" onchange="this.form.submit()">
        <label for="value_factor" class="mdl-textfield__label">Profile</label>
        <ul for="value_factor" class="mdl-menu mdl-menu--bottom-left mdl-js-menu" style="width: auto; min-width: 220px;">
          <li class="mdl-menu__item" data-val="0"{% if value_factor == 0 %} data-selected="true"{% endif %}>
            First Dibs
          </li>
          <li class="mdl-menu__item" data-val="1"{% if value_factor == 1 %} data-selected="true"{% endif %}>
            The Cheapest Stuff
          </li>
          <li class="mdl-menu__item" data-val="2"{% if value_factor == 2 %} data-selected="true"{% endif %}>
            Great Deals
          </li>
          <li class="mdl-menu__item" data-val="4"{% if value_factor == 4 %} data-selected="true"{% endif %}>
            Balanced Drinker
          </li>
          <li class="mdl-menu__item" data-val="8"{% if value_factor == 8 or (value_factor is none) %} data-selected="true"{% endif %}>
            Salaryman Connoiseur
          </li>
          <li class="mdl-menu__item" data-val="12"{% if value_factor == 12 %} data-selected="true"{% endif %}>
            High Class
          </li>
          <li class="mdl-menu__item" data-val="99999999999"{% if value_factor == 99999999999 %} data-selected="true"{% endif %}>
            I Spare No Expense
          </li>
        </ul>
      </div>
    </div>
    <!--Search-->
    <div class="mdl-cell mdl-cell--2-col mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" name="search" id="search-input" value={{search or ""}}>
      <label class="mdl-textfield__label" for="search_input">Search</label>
    </div>
    <!--Price-->
    <div class="mdl-textfield mdl-js-textfield mdl-cell mdl-cell--1-col">
      <input class="mdl-textfield__input" type="text" pattern="[0-9]*" name="min_price" id="min_price" value={{min_price or ""}}>
      <label class="mdl-textfield__label" for="min_price">¥ Min</label>
      <span class="mdl-textfield__error">That's not a number.</span>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-cell mdl-cell--1-col">
      <input class="mdl-textfield__input" type="text" pattern="[0-9]*" name="max_price" id="max_price" value={{max_price or ""}}>
      <label class="mdl-textfield__label" for="max_price">¥ Max</label>
      <span class="mdl-textfield__error">That's not a number.</span>
    </div>
    <!--Had-->
    {% if user is not none %}
    <div class="mdl-cell mdl-cell--1-col vertical-center shrink-width">
      <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="had-checkbox" id="had-label">
        <input type="checkbox" name="exclude_had" id="had-checkbox" class="mdl-checkbox__input" {% if exclude_had %}checked{% endif %}>
        <span class="mdl-checkbox__label"><i class="fas fa-comment-slash"></i></span>
      </label>
      <div class="mdl-tooltip" data-mdl-for="had-label">
        Exclude beers you have checked in
      </div>
    </div>
    {% endif %}
    <!--Styles-->
    <div class="mdl-cell mdl-cell--1-col vertical-center shrink-width">
      <input type="hidden" value="" name="styles" id="styles-input">
      <button id="styles-button" type="button" class="mdl-button mdl-js-button mdl-button--raised" onclick="toggleStyleMenu(); event.stopPropagation()">
        Styles
      </button>
      <div id="style-menu" class="mdl-shadow--2dp hidden">
        <div style="margin: 10px 0px 0px 15px;">
          <a href="#" onclick="selectAllStyles(); return false;">Select all</a> /
          <a href="#" onclick="clearAllStyles(); return false;">Clear</a>
        </div>
        <div id="style-tree"></div>
      </div>
    </div>
    <!--Countries-->
    <div class="mdl-cell mdl-cell--1-col vertical-center shrink-width">
      <input type="hidden" value="" name="countries" id="countries-input">
      <button id="countries-button" type="button" class="mdl-button mdl-js-button mdl-button--raised" onclick="toggleCountryMenu(); event.stopPropagation()">
        Countries
      </button>
      <div id="country-menu" class="mdl-shadow--2dp hidden">
        <div style="margin: 10px 0px 0px 15px;">
          <a href="#" onclick="selectAllCountries(); return false;">Select all</a> /
          <a href="#" onclick="clearAllCountries(); return false;">Clear</a>
        </div>
        <div class="treejs" style="max-height: 400px; overflow-y: auto;">
          <div class="treejs-nodes" style="padding-left: 10px !important; margin-top: 0px;">
            {% for country, count in countries %}
            <div class="treejs-node {% if not selected_countries or country in selected_countries %}treejs-node__checked{% endif %}" data-country="{{country}}">
              <span class="treejs-checkbox"></span>
              <span class="treejs-label">{{country}} ({{count}})</span>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    <!--Submit-->
    <div class="mdl-cell mdl-cell--1-col vertical-center shrink-width">
      <button type="submit" onclick="updateStyles(); updateCountries()" data-upgraded=",MaterialButton" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored">
        <i class="fas fa-redo" aria-hidden="true"></i>
      </button>
    </div>
  </div>
</form>
<div class="mdl-grid" id="beer-grid">
  {% for beer in beers %}
  <div class="mdl-cell mdl-cell--4-col beer-card">
    {% include "offering_card.html" %}
  </div>
  {% endfor %}
</div>
<div id="loading-indicator" style="text-align: center; padding: 20px; display: none;">
  <div class="mdl-spinner mdl-js-spinner is-active"></div>
</div>
<div id="end-of-results" style="text-align: center; padding: 20px; display: none;">
  <p>No more beers to load</p>
</div>

<!-- Mobile filter toggle button -->
<button id="mobile-filter-toggle" class="mobile-filter-toggle mdl-button mdl-js-button mdl-button--fab mdl-button--colored">
  <i class="fas fa-filter"></i>
</button>

<!-- Mobile filter overlay -->
<div id="mobile-filter-overlay" class="mobile-filter-overlay"></div>

<!-- Back to top button -->
<button id="back-to-top" class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" style="position: fixed; bottom: 20px; right: 20px; display: none; z-index: 100;">
  <i class="fas fa-arrow-up"></i>
</button>

<script src="https://cdn.scaleflex.it/filerobot/js-cloudimage-responsive/lazysizes.min.js"></script>
<script src="https://cdn.scaleflex.it/plugins/js-cloudimage-responsive/4.6.6/js-cloudimage-responsive.min.js"></script>
<script/>
  window.ciResponsive = new window.CIResponsive({
    token: "azcojmscrq",
    lazyLoading: true
  });
  window.lazySizes.init();

  // Store data globally for mobile init
  const GROUPED_STYLES = {{grouped_styles|tojson|safe}};
  const ENABLED_STYLES = {{enabled_styles|tojson|safe}};

  (function () {
    initStyleTree(
      '#style-tree',
      GROUPED_STYLES,
      ENABLED_STYLES,
    );
  })();
</script>

{% endblock %}
